{% extends "base.html" %}
{% load static %}

{% block content %}
{% comment %} <link href="{% static 'css/style.css' %}" rel="stylesheet"> {% endcomment %}
<link href="{% static 'css/profile.css' %}" rel="stylesheet">
<div class="profile-container">
    <div class="profile-wrapper">
        <!-- Боковая панель профиля -->
        <div class="profile-sidebar">
            <!-- Аватар и основная информация -->
            <div class="profile-card">
                <div class="profile-avatar">
                    <div class="avatar-placeholder">
                        <i class="bi bi-person-circle"></i>
                    </div>
                    {% if user.first_name %}
                    <h3 class="profile-name">{{ user.first_name }}</h3>
                    {% else %}
                    <h3 class="profile-name">{{ user.username }}</h3>
                    {% endif %}
                    <p class="profile-username">@{{ user.username }}</p>
                </div>
                
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ characters_count|default:"0" }}</div>
                        <div class="stat-label">Персонажей</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ main_character_name|default:"Нет" }}</div>
                        <div class="stat-label">Основной</div>
                    </div>
                </div>
                
                <div class="profile-info">
                    <div class="info-item">
                        <i class="bi bi-envelope"></i>
                        <span>{{ user.email|default:"Не указан" }}</span>
                    </div>
                    <div class="info-item">
                        <i class="bi bi-calendar"></i>
                        <span>Зарегистрирован: {{ user.date_joined|date:"d.m.Y" }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Навигация -->
            <nav class="profile-nav">
                <ul>
                    <li>
                        <a href="{% url 'characters:list' %}" class="nav-link">
                            <i class="bi bi-people"></i>
                            <span>Мои персонажи</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'characters:create' %}" class="nav-link">
                            <i class="bi bi-plus-circle"></i>
                            <span>Создать персонажа</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'users:password_change_form' %}" class="nav-link">
                            <i class="bi bi-key"></i>
                            <span>Сменить пароль</span>
                        </a>
                    </li>
                    <li>
                        <form method="post" action="{% url 'users:logout' %}" class="logout-form">
                            {% csrf_token %}
                            <button type="submit" class="nav-link logout-btn">
                                <i class="bi bi-box-arrow-right"></i>
                                <span>Выйти</span>
                            </button>
                        </form>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- Основное содержание -->
        <div class="profile-content">
            <div class="tab-header">
                <h2><i class="bi bi-person-circle"></i> Профиль {{ user.first_name|default:user.username }}</h2>
            </div>
            <div id="profile-main-content">
                {% if characters %}
                {% include 'characters/list.html' %}
                {{ elif }}
                {% include 'characters/create.html' %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
// JavaScript для динамической загрузки контента
document.addEventListener('DOMContentLoaded', function() {
    // Обработка кликов по навигации
    document.querySelectorAll('.profile-nav a[href]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const url = this.getAttribute('href');
            
            // Загружаем контент без перезагрузки страницы
            fetch(url + '?partial=true')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('profile-main-content').innerHTML = html;
                    
                    // Обновляем активную ссылку
                    document.querySelectorAll('.profile-nav .nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Прокручиваем к верху контента
                    document.getElementById('profile-main-content').scrollIntoView({
                        behavior: 'smooth'
                    });
                })
                .catch(error => {
                    console.error('Error loading content:', error);
                    // В случае ошибки переходим по ссылке обычным способом
                    window.location.href = url;
                });
        });
    });
    
    // Инициализация - делаем активной первую ссылку
    document.querySelector('.profile-nav a[href]').classList.add('active');
});
</script>
{% endblock %}