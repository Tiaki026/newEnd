
{% extends "base.html" %}
{% load static %}
{% block content %}
<link href="{% static 'css/auth.css' %}" rel="stylesheet">
<div class="auth-container">
    <div class="auth-wrapper">
        <div class="auth-card">
            <!-- Заголовок -->
            <div class="auth-header">
                <div class="auth-icon">
                    <i class="bi bi-person-plus"></i>
                </div>
                <h2>Присоединиться к END</h2>
                <p class="auth-subtitle">Создайте аккаунт для доступа ко всем возможностям</p>
            </div>

            {% load user_filters %}
            {% if form.errors %}
                <div class="auth-alert error">
                    <i class="bi bi-exclamation-triangle"></i>
                    <div>
                        {% for field in form %}
                            {% for error in field.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- Форма регистрации -->
            <form method="post" action="{% url 'users:signup' %}" class="auth-form">
                {% csrf_token %}
                
                <!-- Основные поля -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="id_first_name" class="form-label">
                            <i class="bi bi-person-badge"></i>
                            Ваше имя
                        </label>
                        <input type="text" 
                               name="first_name" 
                               id="id_first_name" 
                               class="form-input" 
                               placeholder="Как к вам обращаться?"
                               value="{{ form.first_name.value|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="id_username" class="form-label">
                            <i class="bi bi-at"></i>
                            Имя пользователя *
                        </label>
                        <input type="text" 
                               name="username" 
                               id="id_username" 
                               class="form-input" 
                               required
                               placeholder="Придумайте username"
                               value="{{ form.username.value|default:'' }}">
                        <small class="form-help">150 символов или меньше. Только буквы, цифры и @/./+/-/_</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="id_email" class="form-label">
                        <i class="bi bi-envelope"></i>
                        Email *
                    </label>
                    <input type="email" 
                           name="email" 
                           id="id_email" 
                           class="form-input" 
                           required
                           placeholder="example@domain.com"
                           value="{{ form.email.value|default:'' }}">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="id_password1" class="form-label">
                            <i class="bi bi-key"></i>
                            Пароль *
                        </label>
                        <div class="input-with-icon">
                            <input type="password" 
                                   name="password1" 
                                   id="id_password1" 
                                   class="form-input" 
                                   required
                                   placeholder="Придумайте пароль">
                            <span class="input-icon">
                                <i class="bi bi-lock"></i>
                            </span>
                        </div>
                        <small class="form-help">Минимум 8 символов. Не используйте простые пароли.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="id_password2" class="form-label">
                            <i class="bi bi-key-fill"></i>
                            Подтверждение пароля *
                        </label>
                        <div class="input-with-icon">
                            <input type="password" 
                                   name="password2" 
                                   id="id_password2" 
                                   class="form-input" 
                                   required
                                   placeholder="Повторите пароль">
                            <span class="input-icon">
                                <i class="bi bi-lock-fill"></i>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Кнопка регистрации -->
                <button type="submit" class="auth-btn success">
                    <i class="bi bi-check-circle"></i>
                    Создать аккаунт
                </button>

                <!-- Разделитель -->
                <div class="auth-divider">
                    <span>Дальнейшие шаги</span>
                </div>

                <!-- Блок создания персонажа (будет скрыт/открыт по желанию) -->
                <div class="form-optional" id="character-section">
                    <div class="optional-header">
                        <h4><i class="bi bi-plus-circle"></i> Создать первого персонажа (опционально)</h4>
                        <p class="optional-subtitle">Вы можете создать персонажа сейчас или позже в личном кабинете</p>
                    </div>
                    
                    <div class="optional-content">
                        <div class="form-group">
                            <label class="form-label">Имя персонажа</label>
                            <input type="text" 
                                   name="character_name" 
                                   class="form-input" 
                                   placeholder="Имя вашего первого героя">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Специализация</label>
                            <select name="character_specialization" class="form-select">
                            <option value="">Выберите специализацию</option>
                            {% for spec in specializations %}
                            <option value="{{ spec.id }}" 
                                    data-class="{{ spec.character_class.get_name_display }}"
                                    data-role="{{ spec.get_role_display }}">
                                {{ spec.character_class.get_name_display }} - {{ spec.name }} ({{ spec.get_role_display }})
                            </option>
                            {% endfor %}
                            </select>
                            
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" 
                                   name="character_is_main" 
                                   id="character_is_main" 
                                   class="form-checkbox" 
                                   checked>
                            <label for="character_is_main" class="form-check-label">
                                Сделать основным персонажем
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Ссылка на вход -->
                <div class="auth-footer">
                    <p>Уже есть аккаунт? <a href="{% url 'users:login' %}" class="auth-link">Войти в систему</a></p>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

