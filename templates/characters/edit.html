{% load static %}
{% block content %}
<link href="{% static 'css/auth.css' %}" rel="stylesheet">
<div class="auth-container">
    <div class="auth-signup">
        <div class="auth-card">
            <!-- Заголовок -->
            <div class="auth-header">
                <h2>
                    <i class="bi bi-pencil-square"></i>
                    Редактирование {{ character.name }}
                </h2>
                <p class="auth-subtitle">
                    {{ character.name }} - 
                    {{ character.specialization.character_class.get_name_display }} - 
                    {{ character.specialization.name }}</p>
            </div>

            {% if messages %}
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}success{% endif %}">
                    <i class="bi bi-{% if message.tags == 'error' %}exclamation-triangle{% else %}check-circle{% endif %}"></i>
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}

            {% load user_filters %}
            {% if form.errors %}
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <p><strong>{{ field.label }}:</strong> {{ error }}</p>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="post" action="{% url 'characters:edit' character.id %}" 
                class="auth-form">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="id_name">
                        <i class="bi bi-person-badge"></i>
                        Имя персонажа *
                    </label>
                    {{ form.name }}
                    {% if form.name.help_text %}
                    <small class="form-help">{{ form.name.help_text }}</small>
                    {% endif %}
                    {% if form.name.errors %}
                    <div class="error-text">
                        {% for error in form.name.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="char-count">
                        <span id="nameCounter">{{ form.name.value|length|default:0 }}</span>/16 символов
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="id_specialization">
                        <i class="bi bi-stars"></i>
                        Специализация *
                    </label>
                    {{ form.specialization }}
                    {% if form.specialization.errors %}
                    <div class="error-text">
                        {% for error in form.specialization.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        {% if character.is_main %}
                            {# Если персонаж уже основной, показываем скрытое поле #}
                            {{ form.is_main }}
                            <label class="checkbox-label">
                                <span class="checkbox-custom">
                                    <i class="bi bi-star-fill"></i>
                                </span>
                                <span class="checkbox-text">
                                    Это ваш основной персонаж
                                </span>
                            </label>
                            <small class="form-help">
                                Основной персонаж нельзя отменить через редактирование. 
                                Чтобы сменить основной персонаж, выберите другого как основного в списке персонажей.
                            </small>
                        {% else %}
                            <label class="checkbox-label" for="id_is_main">
                                {{ form.is_main }}
                                <span class="checkbox-custom">
                                    <i class="bi bi-star"></i>
                                </span>
                                <span class="checkbox-text">
                                    Сделать основным персонажем
                                </span>
                            </label>
                            {% if form.is_main.help_text %}
                            <small class="form-help">{{ form.is_main.help_text }}</small>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% if form.is_main.errors %}
                    <div class="error-text">
                        {% for error in form.is_main.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <button type="submit" class="auth-btn success">
                        <i class="bi bi-check-circle"></i>
                        Сохранить изменения
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

    const nameInput = document.getElementById('id_name');
    const nameCounter = document.getElementById('nameCounter');
    
    if (nameInput && nameCounter) {
        nameInput.addEventListener('input', function() {
            nameCounter.textContent = this.value.length;
        });

        nameCounter.textContent = nameInput.value.length;
    }
});
</script>
{% endblock %}